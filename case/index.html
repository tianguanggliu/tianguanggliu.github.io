<html lang="zh-cn"><br><br><head><br>    <meta http-equiv="content-type" content="text/html;charset=utf-8"><br>    <meta http-equiv="cache-control" content="max-age=86400"><br>    <meta name="apple-mobile-web-app-capable" content="yes"><br>    <meta name="apple-mobile-web-app-status-bar-style" content="default"><br>    <meta name="msapplication-tap-highlight" content="no"><br>    <meta name="format-detection" content="telephone=no"><br>    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><br>    <meta charset="UTF-8"><br>    <title>东易清明上河图</title><br>    <script src="http://pgtoq1cmw.bkt.clouddn.com/blog-case/js/openseadragon.min.js"></script><br>    <script src="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript" charset="utf-8"></script><br>    <link rel="stylesheet" href="http://pgtoq1cmw.bkt.clouddn.com/blog-case/css/qmsht-index.css"><br><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><br><br><body style="margin: 0"><br>    <audio src="http://pgtoq1cmw.bkt.clouddn.com/blog-case/audio/qmsht-bg.mp3" id="music" loop></audio><br>    <div id="toolbarDiv"></div><br>    <div id="openSeadragon" style="width:100vw; height:100vh;"></div><br>    <div id="longpress-btn"></div><br>    <div id="outerWrap"><br>            <section id="sec-load" style="display: block;"><br>                <div id="load-p"><br>                    0%<br>                </div><br>                <p></p><br>                <dl class="horizontal"><dt class="vertical"><!--<b id="load-ball"></b>--></dt></dl><br>            </section><br>    </div><br>    <section id="sec-btn"><br>            <div id="end-btns"><br>                <a href="javascript:;" id="share-btn" alt="邀请好友观看" target="_blank" rel="noopener"></a><br>                <a href="javascript:;" id="play-again" alt="再看一次" target="_blank" rel="noopener"></a><br>            </div><br>    </section><br>    <section id="sec-share"></section><br></body><br><script><br>    “undefined”!=typeof jQuery&amp;&amp;!function(a){“use strict”;a.imgpreload=function(b,c){c=a.extend({},a.fn.imgpreload.defaults,c instanceof Function?{all:c}:c),”string”==typeof b&amp;&amp;(b=[b]);var d=[];a.each(b,function(e,f){var g=new Image,h=f,i=g;”string”!=typeof f&amp;&amp;(h=a(f).attr(“src”)||a(f).css(“background-image”).replace(/^url((?:”|’)?(.<em>)(?:’|”)?)$/gm,”$1”),i=f),a(g).bind(“load error”,function(e){d.push(i),a.data(i,”loaded”,”error”==e.type?!1:!0),c.each instanceof Function&amp;&amp;c.each.call(i,d.slice(0)),d.length&gt;=b.length&amp;&amp;c.all instanceof Function&amp;&amp;c.all.call(d),a(this).unbind(“load error”)}),g.src=h})},a.fn.imgpreload=function(b){return a.imgpreload(this,b),this},a.fn.imgpreload.defaults={each:null,all:null}}(jQuery);<br></script><br><script type="text/javascript"><br>    var defaultZoomLevel = 1;<br>    var openSeadragonInstance,<br>        viewport,<br>        point,<br>        percentage,<br>        moveY = 0,<br>        maxY,<br>        timInterval,<br>        loadP=0,<br>        loadTp;<br><br>/<strong> 文档加载完毕 </strong>/<br>    $(function() {<br>       LoadImages();<br>       openMap();<br>        $(‘#btn’).click(function() {<br>            beganToMove();<br><br>            console.log(‘start’)<br>        })<br>    })<br>/<strong> 开始加载 图片 </strong>/<br>function openMap() {<br>        openSeadragonInstance = OpenSeadragon({<br>        minZoomLevel: defaultZoomLevel,     // 最小缩放等级<br>        animationTime: 0.3,<br>        visibilityRatio: 1.0,<br>        maxZoomLevel: 16,<br>        constrainDuringPan: true,<br>        showNavigator: false,               // 显示导航<br>        showZoomControl: false,             // 则显示+和 - 按钮以放大和缩小。<br>        showHomeControl: false,             // 显示主页<br>        showFullPageControl: false,         // 显示全屏<br>        iOSDevice: !isAndroid(),<br>        immediateRender: true,              // 首先渲染最佳最近水平，忽略降低水平，提供非常模糊到锐利的效果。建议将移动设备的设置更改为true。<br>        defaultZoomLevel: defaultZoomLevel, // 首次打开图像或单击主页按钮时使用的缩放级别。如果为0，则调整以适合查看者。<br>        useCanvas: true,            // 设置为false，即使支持canvas，也不使用HTML canvas元素进行图像渲染。 安卓关闭 ios 开启<br>        id: ‘openSeadragon’,<br>        prefixUrl: ‘./images/‘,<br>        preserveImageSizeOnResize: true,<br>        minPixelRatio: 1,<br>        tileSources: {<br>            Image: {<br>                xmlns: ‘<a href="http://schemas.microsoft.com/deepzoom/2009&#39;">http://schemas.microsoft.com/deepzoom/2009&#39;</a>,<br>                Url: ‘<a href="http://pgtoq1cmw.bkt.clouddn.com/blog-case/img/qmsht/flies/&#39;">http://pgtoq1cmw.bkt.clouddn.com/blog-case/img/qmsht/flies/&#39;</a>,<br>                Overlap: ‘1’,<br>                TileSize: ‘256’,<br>                Format: ‘jpg’,<br>                Size: {<br>                    Height: ‘46756’,<br>                    Width: ‘2071’<br>                }<br><br>            }<br><br>        }<br><br>    });<br>    viewport = openSeadragonInstance.viewport;<br>    point = OpenSeadragon.Point;<br>    percentage = viewport.getBounds().height / viewport.getBounds().width;<br>    moveY = 0;<br>    maxY = 46756/2071 - percentage;<br>    openSeadragonInstance.addHandler(‘canvas-click’, function(event) {<br>        console.log(event)<br>    })<br>    mapInit();<br>}<br><br>/<strong> 长按按钮press js 控制移动图像 </strong>/<br>function beganToMove() {<br>    if (timInterval) {clearInterval(timInterval)}<br>    timInterval = setInterval(function() {<br>        var newBounds = new OpenSeadragon.Rect(0, moveY, 1, percentage);<br>        viewport.fitBounds(newBounds, false);<br>        moveY = moveY + maxY/10300;<br>        if (moveY &gt;= maxY) {<br>            clearInterval(timInterval);<br>            $(“#sec-btn”).css(‘display’, ‘flex’);<br>            $(“#play-again”).click(function() {<br>                mapInit();<br>                $(“#sec-btn”).fadeOut(0);<br>                $(“#longpress-btn”).fadeIn(400);<br>            })<br>            $(“#share-btn”).click(function() {<br>                $(“#sec-share”).fadeIn(200).click(function() {<br>                    $(“#sec-share”).fadeOut(200)<br>                });<br>            })<br><br>            $(“#longpress-btn”).fadeOut(400);<br>            audioPlay(false);<br>        }<br>    },10)<br>}<br>/<strong> 加载图像完成 初始化把图像 left-top 对齐 </strong>/<br>function mapInit() {<br>    moveY = 0;<br>    var timeout = setTimeout(function() {<br>    var newBounds = new OpenSeadragon.Rect(0, 0, 1, percentage);<br>    viewport.fitBounds(newBounds, true);<br>    clearTimeout(timeout)<br>    })<br>}<br></script><br><script><br><br>/<strong> 长按按钮 touch事件 </strong>/<br>function SetHamm(){<br>    $(“#longpress-btn”).off(“touchstart”).on( “touchstart”, btnPanPressAct);<br>    $( “#longpress-btn” ).off(“touchend”).on( “touchend”, btnPanEndAct);<br>}<br>function DestroyPress(){<br>    $( “#longpress-btn” ).off(“touchstart”);<br>    $( “#longpress-btn” ).off(“touchend”);<br>}<br>function btnPanPressAct(e){<br>    e.preventDefault();<br>    audioPlay(true);<br>    beganToMove();<br>    console.log(‘touchstart’)<br>}<br>function btnPanEndAct(e){<br>    e.preventDefault();<br>    audioPlay(false);<br>    if (timInterval) {clearInterval(timInterval)}<br>    console.log(‘touchend’)<br>}<br><br>/<strong> 判断屏幕方向,如果是横屏提示锁定方向旋转 </strong></em>/<br>(function rotate() {<br>    var orientation = window.orientation;<br>    if (orientation == 90 || orientation == -90) {<br>        alert(“请使用锁定方向旋转”);<br>    }<br>    window.onorientationchange = function() {<br>        document.body.style.display = “block”;<br>        rotate();<br>    };<br>})()<br><br>/<strong> 判断是否 Android 系统 </strong>/<br>function isAndroid() {<br>    return navigator.userAgent.indexOf(‘Android’) &gt; -1 || navigator.userAgent.indexOf(‘Adr’) &gt; -1<br>}<br><br>/<strong> 音乐控制方法 params flag=true 播放</strong>/<br>function audioPlay(flag) {<br>    var musicEle = $(‘#music’);<br>    if (flag) {<br>        musicEle[0].play()<br>    } else {<br>        musicEle[0].pause()<br>    }<br>}<br>/<strong> 加载图片 </strong>/<br>function LoadImages(){<br>    var loadImages=[“hand”,”btn-share”,”btn-again”,”share_bg”];<br>    var basePath=”<a href="http://pgtoq1cmw.bkt.clouddn.com/blog-case/img/qmsht/&quot;">http://pgtoq1cmw.bkt.clouddn.com/blog-case/img/qmsht/&quot;</a>;<br>    for(var i=0;i&lt;loadImages.length;i++) {<br>        loadImages[i] = basePath + loadImages[i] + ‘.png’<br>    }<br>    jQuery.imgpreload(loadImages,{<br>        number: 4,<br>        each: function(imgs){<br>            var loadPercent= (imgs.length*100/loadImages.length + 0.5 ) | 0;<br>            loadTp=parseInt(loadPercent);<br>        },<br>        all: function(){loadTp=100;}<br>    });<br>    var nowTimeNumber = $.now();<br>    var loadInterv = setInterval(function() {<br>        loadP+=1;<br>        (loadP&gt;loadTp) &amp;&amp; (loadP=loadTp);<br>        if(loadP&gt;=100){<br>            setTimeout(function() {<br>                $(“#load-p”).text(“100%”);<br>                $(“#outerWrap”).fadeOut(400, SetHamm);<br>                $(“#longpress-btn”).fadeIn(400);<br>                clearInterval(loadInterv)<br>            }, $.now() - nowTimeNumber &gt; 4000 ? 0 : 4000 + nowTimeNumber - $.now())<br>        }else{<br>            $(“#load-p”).text(loadP+”%”);<br>        }<br>    }, 20);<br>}<br></script><br></html>
